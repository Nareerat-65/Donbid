<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</title>
    <link rel="stylesheet" href="purchaseCoins-styles.css">
</head>

<body>
    <nav name="navbar" class="navbar">
        <div>
            <a href="../content/main-and-login.html" class="logo-link">
                <img src="../pic/Logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" class="logo">
            </a>
        </div>
        <div class="balance">üí∞ Coin: <span id="coinBalance">0.00</span></div>
    </nav>

    <div class="content">
        <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</h2>
        <!-- Repeat this process for each package you want to add -->
        <div class="packages">
            <div class="package">
                <h3>Starter</h3>
                <div class="coins">20 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">20 ‡∏ö‡∏≤‡∏ó</div>
                <button class="btn" onclick="openPopup('Starter', 20)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Basic</h3>
                <div class="coins">55 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">50 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +5</div>
                <button class="btn" onclick="openPopup('Basic', 50)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Standard</h3>
                <div class="coins">115 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">100 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +15</div>
                <button class="btn" onclick="openPopup('Standard', 100)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Pro</h3>
                <div class="coins">240 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">200 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +40</div>
                <button class="btn" onclick="openPopup('Pro', 200)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Premium</h3>
                <div class="coins">625 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">500 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +125</div>
                <button class="btn" onclick="openPopup('Premium', 500)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Ultimate</h3>
                <div class="coins">1,300 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">1,000 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +300</div>
                <button class="btn" onclick="openPopup('Ultimate', 1000)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </div>
    </div>
    <div class="overlay" id="paymentPopup">
        <div class="popup">
            <div class="close-btn" onclick="closePopup()">√ó</div>
            <h2>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
            <p>‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à: <span id="popupPackage"></span></p>
            <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: <span id="popupAmount"></span> ‡∏ö‡∏≤‡∏ó</p>

            <div class="payment-methods">
                <button>‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</button>
                <button>TrueMoney</button>
                <button>PromptPay</button>
                <button>PayPal</button>
            </div>

            <div class="payment-summary">
                <p>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: <b id="popupTotal"></b> ‡∏ö‡∏≤‡∏ó</p>
                <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î ‚Äú‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‚Äù ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </div>

            <button class="confirm-btn" onclick="confirmPayment()">‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
    </div>
    <script>
        // üÜï ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        let selectedAmount = 0;

        // üÜï ‡πÄ‡∏õ‡∏¥‡∏î popup ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function openPopup(packageName, amount) {
            selectedAmount = amount;
            document.getElementById('popupPackage').textContent = packageName;
            document.getElementById('popupAmount').textContent = amount.toFixed(2);
            document.getElementById('popupTotal').textContent = amount.toFixed(2);
            document.getElementById('paymentPopup').style.display = 'flex';
        }

        // üÜï ‡∏õ‡∏¥‡∏î popup
        function closePopup() {
            document.getElementById('paymentPopup').style.display = 'none';
        }
        async function selectPackage(amount) {
            const token = localStorage.getItem('token');
            if (!token) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô");
                return;
            }

            try {
                const res = await fetch('/api/coins/topup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount })
                });

                const data = await res.json();

                if (res.ok) {
                    if (data.token) {
                        localStorage.setItem('token', data.token); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï token ‡πÉ‡∏´‡∏°‡πà
                    }

                    alert(`‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: ${Number(data.coin_balance).toFixed(2)} ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå`);
                    document.getElementById('coinBalance').textContent = Number(data.coin_balance).toFixed(2);

                } else {
                    alert(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
            } catch (err) {
                console.error(err);
                alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
            }
        }

        async function confirmPayment() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô");
                return;
            }

            try {
                const res = await fetch('/api/coins/topup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount: selectedAmount })
                });

                const data = await res.json();

                if (res.ok) {
                    if (data.token) {
                        localStorage.setItem('token', data.token);
                    }

                    alert(`‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: ${Number(data.coin_balance).toFixed(2)} ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå`);
                    document.getElementById('coinBalance').textContent = Number(data.coin_balance).toFixed(2);
                    closePopup(); // üÜï ‡∏õ‡∏¥‡∏î popup ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                } else {
                    alert(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
            } catch (err) {
                console.error(err);
                alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
            }
        }

        window.onload = async () => {
            const token = localStorage.getItem('token');
            if (!token) return;

            const res = await fetch('/api/coins/balance', {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            const data = await res.json();
            document.getElementById('coinBalance').textContent = Number(data.coin_balance).toFixed(2);
        };

    </script>

</body>

</html>