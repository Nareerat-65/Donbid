<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</title>
    <link rel="stylesheet" href="purchaseCoins-styles.css">
</head>

<body>
    <nav name="navbar" class="navbar">
        <div>
            <a href="../content/main-and-login.html" class="logo-link">
                <img src="../pic/Logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" class="logo">
            </a>
        </div>
        <div class="balance">üí∞ Coin: <span id="coinBalance">0.00</span></div>
    </nav>

    <div class="content">
        <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</h2>
        <!-- Repeat this process for each package you want to add -->
        <div class="packages">
            <div class="package">
                <h3>Starter</h3>
                <div class="coins">20 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">20 ‡∏ö‡∏≤‡∏ó</div>
                <button class="btn" onclick="selectPackage(20)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Basic</h3>
                <div class="coins">55 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">50 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +5</div>
                <button class="btn" onclick="selectPackage(50)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Standard</h3>
                <div class="coins">115 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">100 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +15</div>
                <button class="btn" onclick="selectPackage(100)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Pro</h3>
                <div class="coins">240 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">200 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +40</div>
                <button class="btn" onclick="selectPackage(200)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Premium</h3>
                <div class="coins">625 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">500 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +125</div>
                <button class="btn" onclick="selectPackage(500)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
            <div class="package">
                <h3>Ultimate</h3>
                <div class="coins">1,300 ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå</div>
                <div class="price">1,000 ‡∏ö‡∏≤‡∏ó</div>
                <div class="bonus">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ +300</div>
                <button class="btn" onclick="selectPackage(1000)">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </div>
    </div>
    <script>
        async function selectPackage(amount) {
            const token = localStorage.getItem('token');
            if (!token) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô");
                return;
            }

            try {
                const res = await fetch('/api/coins/topup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount })
                });

                const data = await res.json();

                if (res.ok) {
                    if (data.token) {
                        localStorage.setItem('token', data.token); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï token ‡πÉ‡∏´‡∏°‡πà
                    }
        
                    alert(`‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: ${Number(data.coin_balance).toFixed(2)} ‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå`);
                    document.getElementById('coinBalance').textContent = Number(data.coin_balance).toFixed(2);

                } else {
                    alert(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
            } catch (err) {
                console.error(err);
                alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
            }
        }
        window.onload = async () => {
            const token = localStorage.getItem('token');
            if (!token) return;

            const res = await fetch('/api/coins/balance', {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            const data = await res.json();
            document.getElementById('coinBalance').textContent = Number(data.coin_balance).toFixed(2);
        };

    </script>

</body>

</html>